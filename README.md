# WebApp

Playground for all things Azure cloud.

## Build Pipeline

This solution takes advantage of Nuke.Build to define its CI pipeline. GitHub Action is uses to run the CI pipelines by publishing and deploying the artifacts to a Azure Web Service.

You can view the results at https://eilerpoulsen.com

### Nuke.Build

Nuke.Build is a CI automation tool for .NET solutions. In this case, the application publishes the webapp artifacts and subsequently publishes the artifacts to Azure through zip deployment. 

Nuke is set up to generate a workflow file that will run the CI process. This file is is generated at *github/workflows/ci.yml*, and is updated each time the command *nuke* is run within the root of the repository. This has the benefit of allowing you to test run your CI pipelines locally without having to commit and push your changes to test it on GitHub Action.

If you are running Windows, ensure that the end of line format is LN for all generated and updated files. Otherwise the CI workflow in GitHub Action will fail to run.

See the documentation on how to install and run the global tool: https://nuke.build/docs/introduction/#fast-track

In order to ensure that the artifacts can be deployed to Azure through the zip deployment method, the following secret variables need to be entered when running the workflow: 

| Secret              | Value    |
| ------------------- | -------- |
| APP_SERVICE_NAME    | _SECRET_ |
| WEB_DEPLOY_USERNAME | _SECRET_ |
| WEB_DEPLOY_PASSWORD | _SECRET_ |

This can either be entered manually, or by defining the secret variables through the global nuke tool. See the following documentation on how to configure secrets: https://nuke.build/docs/global-tool/secrets/

The deployed application contains the commit sha value in its footer. This enables the administrator (in this case me) to be aware of what version of the application is deployed. The application's *AppVersionInfo.cs* service retrives this value at runtime from its assembly. See the Publish step in the *build/Build.cs* on how this is achieved.

### GitHub Action

GitHub Actions executes the *github/workflows/ci.yml* file generated by Nuke.Build as a workflow. The workflow is initiated whenever a new commit is pushed to the *main* branch. 

In order to ensure that the artifacts can be deployed to Azure through the zip deployment method, the following secret variables need to be set up in the repository.

| Secret              | Value    |
| ------------------- | -------- |
| APP_SERVICE_NAME    | _SECRET_ |
| WEB_DEPLOY_USERNAME | _SECRET_ |
| WEB_DEPLOY_PASSWORD | _SECRET_ |

This can be achieved by navigating to the repository's settings page -> Security -> Secrets -> Actions. There you can create new repository secrets through the "New repository secret" button.

